@model IEnumerable<Product>
<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý sản phẩm</title>
    <link rel="stylesheet" href="product-management.css">
    <link href="~/css/admin/quanlysanpham.css" rel="stylesheet" />
</head>
<body>
    <div class="product-management_sp">
        <h2>Quản lý sản phẩm 6TL De Decor</h2>
        <div class="search-bar_sp">
            <input type="text" placeholder="Tìm kiếm...">
            <select>
                <option value="all">Chọn danh mục</option>
                @foreach (var categories in ViewBag.Categories)
                {
                    <option value="@categories.CategoryId">@categories.CategoryName</option>
                }
            </select>

            <a href="/Admin/Products/ThemSanPham"><button class="add-new-btn_sp">Thêm mới</button></a>

        </div>

        <table class="product-table_sp">
            <thead>
                <tr>
                    <th>Mã SP</th>
                    <th>Hình ảnh</th>
                    <th>Tên SP</th>
                    <th>Giá bán</th>
                    <th>Loại</th>
                    <th>Màu sắc</th>
                    <th>Chất liệu</th>
                    <th>Trạng thái</th>
                    <th>Chức năng</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in Model)
                {
                    <tr>
                        <td>@product.ProductId</td>
                        <td><img src="@product.Image" alt="Hình ảnh SP"></td>
                        <td>@product.ProductName</td>
                        <td>@product.Price?.ToString("N0", new System.Globalization.CultureInfo("vi-VN")) VNĐ</td>

                        <td>@product.Category?.CategoryName</td>

                        <td>
                            @foreach (var productColor in product.ProductColors)
                            {
                                <span>@productColor.Color?.ColorName</span>
                                <br />
                            }
                        </td>

                        <td>@product.Material</td>

                        <td>
                            @if (product.ProductColors.Sum(pc => pc.Quantity) > 0)
                            {
                                <span>Còn hàng</span>
                            }
                            else
                            {
                                <span>Hết hàng</span>
                            }
                        </td>

                        <td>
                            <a href="/Admin/Products/SuaSanPham/@product.ProductId">
                                <button class="edit-btn_sp">Sửa</button>
                            </a>
                            <button onclick="deleteProduct(@product.ProductId)" class="delete-btn_sp">Xóa</button>
                        </td>
                    </tr>
                }

            </tbody>
        </table>

        <div class="pagination_sp">
            <button class="page-btn_sp">1</button>
            <button class="page-btn_sp">2</button>
        </div>
    </div>

    <!-- Success Popup -->
    <div id="successPopup" class="popup" style="display: none;">
        <p>Sản phẩm đã được xóa thành công!</p>
    </div>

    <script>
        function deleteProduct(productId) {
            // Xác nhận việc xóa sản phẩm
            if (confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")) {
                // Gửi yêu cầu AJAX để xóa sản phẩm
                $.ajax({
                    url: '/Admin/Products/QuanLySanPham/' + productId,  // Đường dẫn xóa sản phẩm
                    type: 'POST', // Cập nhật thành POST vì bạn có thể muốn sử dụng [HttpPost] cho phương thức xóa trên controller.
                    data: { productId: productId },  // Gửi productId làm tham số
                    success: function (response) {
                        // Kiểm tra phản hồi từ server
                        if (response.success) {
                            // Xóa sản phẩm khỏi bảng sau khi xóa thành công
                            $('tr').each(function () {
                                if ($(this).find('td').first().text() == productId) {
                                    $(this).remove();
                                }
                            });
                            openPopup();  // Hiển thị popup thành công
                        } else {
                            alert("Có lỗi xảy ra khi xóa sản phẩm.");
                        }
                    },
                    error: function () {
                        alert("Có lỗi xảy ra khi xóa sản phẩm.");
                    }
                });
            }
        }

        function openPopup() {
            // Hiển thị popup thông báo thành công
            document.getElementById('successPopup').style.display = 'flex';
            setTimeout(closePopup, 3000); // Tự động đóng popup sau 3 giây
        }

        function closePopup() {
            document.getElementById('successPopup').style.display = 'none';
        }

    </script>

    
</body>
</html>
