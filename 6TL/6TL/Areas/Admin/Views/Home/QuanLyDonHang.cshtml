<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/css/admin/QuanLyDonHang.css" rel="stylesheet" />
    <title>Quản lý đơn hàng</title>
</head>
<body>
    <div class="order-management">
        <h1>Quản lý đơn hàng</h1>
        <div class="filter-container">
            <div class="filter-item">
                <label for="filter-status">Trạng thái:</label>
                <select id="filter-status">
                    <option value="">Tất cả</option>
                    <option value="success">Đã giao</option>
                    <option value="failed">Đã hủy</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filter-date">Ngày tạo:</label>
                <input type="date" id="filter-date" />
            </div>
            <div class="filter-item">
                <label for="search-order">Mã đơn hàng:</label>
                <input type="text" id="search-order" placeholder="Nhập mã đơn hàng..." />
            </div>
            <button id="apply-filter-qldh">Lọc</button>
        </div>

        <table class="order-table">
            <thead>
                <tr>
                    <th>Mã đơn hàng</th>
                    <th>Khách hàng</th>
                    <th>Ngày tạo</th>
                    <th>Tên sản phẩm</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Thanh toán</th>
                    <th>Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                
                </tr>
            </thead>
            <tbody>
                <tr class="main-row">
                    <td>#123</td>
                    <td>Nguyễn Văn A</td>
                    <td>09/11/2024</td>
                    <td>Ghế Sofa</td>
                    <td>1.500.000</td>
                    <td>1</td>
                    <td>Tiền mặt</td>
                    <td>3,750,000 VND</td>
                    <td><span class="status success-qldh">Đã giao</span></td>
                    <td>
                        <div class="button-container">
                            <button class="btn-view toggle-detail" onclick="viewDetails('#123')">Xem</button>
                            <button class="btn-cancel" onclick="cancelOrder('#123')">Hủy</button>
                        </div>
                    </td>


                </tr>
                <tr class="main-row">
                    <td>#124</td>
                    <td>Nguyễn Văn B</td>
                    <td>10/11/2024</td>
                    <td>Bàn ăn</td>
                    <td>2.000.000</td>
                    <td>1</td>
                    <td>Chuyển khoản</td>
                    <td>2,000,000 VND</td>
                    <td><span class="status failed-qldh">Đã hủy</span></td>
                    <td>
                        <div class="button-container">
                            <button class="btn-view toggle-detail" onclick="viewDetails('#123')">Xem</button>
                            <button class="btn-cancel" onclick="cancelOrder('#123')">Hủy</button>
                        </div>
                    </td>

                
                </tr>
                <!-- More rows... -->
            </tbody>
        </table>
    </div>
   

    <script>
        // JavaScript để bật/tắt chi tiết đơn hàng
        document.querySelectorAll('.toggle-detail').forEach(button => {
            button.addEventListener('click', () => {
                const detailRow = button.closest('tr').nextElementSibling;
                detailRow.style.display = detailRow.style.display === 'table-row' ? 'none' : 'table-row';
            });
        });

        document.getElementById('apply-filter-qldh').addEventListener('click', function () {
            const statusFilter = document.getElementById('filter-status').value.toLowerCase();
            const dateFilter = document.getElementById('filter-date').value; // yyyy-mm-dd
            const orderFilter = document.getElementById('search-order').value.toLowerCase();

            const rows = document.querySelectorAll('.order-table tbody tr.main-row');

            rows.forEach(row => {
                const statusText = row.querySelector('td:nth-child(9)').textContent.trim().toLowerCase();
                const dateText = row.querySelector('td:nth-child(3)').textContent.trim();
                const orderIdText = row.querySelector('td:nth-child(1)').textContent.trim().toLowerCase();

                // Chuyển ngày từ bảng thành định dạng 'yyyy-mm-dd'
                const dateParts = dateText.split('/');
                const formattedDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;

                // Kiểm tra từng điều kiện
                const matchesStatus = !statusFilter || statusText.includes(statusFilter);
                const matchesDate = !dateFilter || formattedDate === dateFilter;
                const matchesOrder = !orderFilter || orderIdText.includes(orderFilter);

                // Hiển thị hoặc ẩn hàng
                if (matchesStatus && matchesDate && matchesOrder) {
                    row.style.display = ''; // Hiển thị
                } else {
                    row.style.display = 'none'; // Ẩn
                }
            });
        });

        function viewDetails(orderId) {
            // Điều hướng đến trang chi tiết đơn hàng, truyền mã đơn hàng qua URL
            window.location.href = `https://localhost:7041/admin/Home/quanlychitietDonhang?orderId=${orderId}`;
        }
        // Hàm mở popup xác nhận và thay đổi nội dung
function openConfirmPopup(message) {
    const confirmPopup = document.getElementById('confirmPopup');
    const popupContent = confirmPopup.querySelector('.popup-content h4');
    popupContent.textContent = message; // Thay đổi nội dung của popup xác nhận
    confirmPopup.style.display = 'flex'; // Hiển thị popup
}

        function cancelOrder(orderId) {

            openConfirmPopup('Hủy đơn hàng thành công!')
        }

        // Hàm lấy giá trị tham số từ URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Lấy mã đơn hàng từ URL
        const orderId = getQueryParam('orderId');

        // Hiển thị mã đơn hàng (bạn có thể gọi API để lấy thông tin chi tiết)
        if (orderId) {
            document.querySelector('.header').textContent = `CHI TIẾT ĐƠN HÀNG: ${orderId}`;
            // Thực hiện logic hiển thị thông tin chi tiết đơn hàng dựa trên orderId
        }

        function openPopup() {
            document.getElementById('successPopup').style.display = 'flex';
            setTimeout(closePopup, 3000); // Tự động đóng popup sau 3 giây
        }

        function closePopup() {
            document.getElementById('successPopup').style.display = 'none';
        }
    </script>
</body>
</html>
