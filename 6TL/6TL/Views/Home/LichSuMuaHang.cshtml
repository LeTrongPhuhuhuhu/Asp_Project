@{
    ViewData["Title"] = "Lịch sử mua hàng";

    // Dữ liệu giả về lịch sử đơn hàng
    var orders = new List<dynamic>
    {
        new { OrderId = "001", Status = "Đang xử lý", Shipping = "Vận chuyển", Payment = "Chưa thanh toán", Amount = 500000, Address = "Hà Nội", OrderDate = "01/01/2024", DeliveryDate = "05/01/2024" },
        new { OrderId = "002", Status = "Đã giao", Shipping = "Đã giao hàng", Payment = "Đã thanh toán", Amount = 1200000, Address = "TP Hồ Chí Minh", OrderDate = "02/01/2024", DeliveryDate = "06/01/2024" }
    };

    // Tính tổng giá trị đơn hàng
    var totalAmount = orders.Sum(o => o.Amount);
}

<h2>Lịch sử mua hàng</h2>

<!-- Thanh tìm kiếm -->
<div class="search-container">
    <input type="text" id="searchOrder" placeholder="Tìm kiếm theo mã đơn hàng hoặc trạng thái..." />
</div>

<!-- Bảng lịch sử mua hàng -->
<table class="order-history">
    <thead>
        <tr>
            <th>Mã đơn hàng</th>
            <th>Trạng thái</th>
            <th>Giao hàng</th>
            <th>Thanh toán</th>
            <th>Giá trị</th>
            <th>Địa chỉ</th>
            <th>Ngày đặt hàng</th>
            <th>Ngày giao hàng</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in orders)
        {
            <tr>
                <td>@order.OrderId</td>
                <td><span class="status @(order.Status == "Đã giao" ? "completed" : "processing")">@order.Status</span></td>
                <td>@order.Shipping</td>
                <td>@order.Payment</td>
                <td>@order.Amount.ToString("N0") VND</td>
                <td>@order.Address</td>
                <td>@order.OrderDate</td>
                <td>@order.DeliveryDate</td>
                <td class="actions">
                    <button class="view-btn" onclick="showOrderDetail('@order.OrderId')"><i class="fas fa-eye"></i> Xem chi tiết</button>
                </td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <td colspan="4" style="text-align: right; font-weight: bold;">Tổng giá trị:</td>
            <td colspan="4" id="totalAmount" style="font-weight: bold;">@totalAmount.ToString("N0") VND</td>
        </tr>
    </tfoot>
</table>

<!-- Phân trang -->
<div class="pagination">
    <button class="prev">Trang trước</button>
    <span>Trang 1/10</span>
    <button class="next">Trang sau</button>
</div>

<!-- Modal xem chi tiết -->
<div id="orderModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Chi tiết đơn hàng</h2>
        <div id="orderDetailContent">
            <!-- Chi tiết đơn hàng sẽ được hiển thị ở đây -->
        </div>
        <!-- Nút hủy đơn hàng -->
        <button id="cancelOrderButton" onclick="cancelOrder()">Hủy</button>

    </div>
</div>

<script>
    // Mở Modal xem chi tiết đơn hàng
    function showOrderDetail(orderId) {
        // Dữ liệu giả chi tiết đơn hàng
        var orderDetails = {
            "001": ["Sofa - Số lượng: 1", "Bàn - Số lượng: 2"],
            "002": ["Giường - Số lượng: 1", "Tủ - Số lượng: 1"]
        };

        // Hiển thị chi tiết đơn hàng vào modal
        var orderDetailContent = document.getElementById("orderDetailContent");
        var details = orderDetails[orderId] ? orderDetails[orderId].join("<br>") : "Không có chi tiết.";
        orderDetailContent.innerHTML = `
                <p>Mã đơn hàng: ${orderId}</p>
                <ul>${details}</ul>
                <p>Tổng giá trị: ${(orderId === "001" ? "500,000" : "1,200,000")} VND</p>
            `;

        // Gắn orderId vào button hủy
        var cancelOrderButton = document.getElementById("cancelOrderButton");
        cancelOrderButton.setAttribute("data-order-id", orderId);

        // Hiển thị Modal
        document.getElementById("orderModal").style.display = "block";
    }

    // Đóng Modal
    function closeModal() {
        document.getElementById("orderModal").style.display = "none";
    }

    // Hủy đơn hàng
    function cancelOrder() {
        var cancelOrderButton = document.getElementById("cancelOrderButton");
        var orderId = cancelOrderButton.getAttribute("data-order-id");

        // Xử lý logic hủy đơn hàng ở đây
        alert(`Đơn hàng ${orderId} đã được hủy!`);

        // Đóng modal sau khi hủy
        closeModal();
    }
</script>
<link href="~/css/pages/lichsumuahang.css" rel="stylesheet" />